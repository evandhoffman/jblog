---
title: 'XFS write speeds: software RAID 0/5/6 across 45 spindles'
author: Evan Hoffman
layout: post
permalink: /2013/01/02/xfs-write-speeds-software-raid-056-across-45-spindles/
amazon-product-excerpt-hook-override:
  - 3
amazon-product-content-hook-override:
  - 2
amazon-product-newwindow:
  - 3
categories:
  - Uncategorized
tags:
  - backblaze
  - devops
  - ext4
  - hardware
  - linux
  - mdadm
  - protocase
  - raid0
  - raid5
  - raid6
  - storage
  - work
  - xfs
---
We&#8217;re currently building a new storage server to store low-priority data (tertiary backups, etc). One of the requirements for the project is that it needs to be on cheap storage (as opposed to expensive enterprise SAN/NAS). After some research we decided to build a <a href="http://blog.backblaze.com/2011/07/20/petabytes-on-a-budget-v2-0revealing-more-secrets/" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://blog.backblaze.com/2011/07/20/petabytes-on-a-budget-v2-0revealing-more-secrets/', 'Backblaze pod']);" >Backblaze pod</a>. Backblaze used 3TB Hitachi drives in their system, but the ones they listed in their blog post are discontinued and the reviews for all other 3TB+ drives were terrible, so we went with <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16822152245" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://www.newegg.com/Product/Product.aspx?Item=N82E16822152245', 'Samsung ST2000DL004']);" >Samsung ST2000DL004</a> 2TB 7200 RPM drives. Like Backblaze, we&#8217;re going with software raid, but I figured a good first step would be to figure out what RAID level we want to use, and if we want to use the mdadm/LVM mish-mosh Backblaze uses, or find something simpler. For my testing I created a RAID6 of all 45 drives and created a single XFS volume (XFS&#8217;s size limit is ~8 exabytes vs ext4&#8217;s 16TB). Ext4 may present some performance advantages, but the management overhead is probably not worth it in our case.

So, this is just a simple benchmarking comparing RAID 0 (stripe with no parity) as a baseline, RAID5 (stripe with 1 parity disk) and RAID6 (stripe with 2 parity disks) across 45 total spindles. For all tests I used Linux software RAID (mdadm). 

To test, I have 3 scripts, makeraid0.sh, makeraid5.sh, and makeraid6.sh. Each one does what its name implies. The raid0 has 43 disks, raid5 has 44 disks, and raid6 has 45 disks, so there are 43 &#8220;data&#8221; disks in each test. The system is a <a href="http://protocase.com/products/index.php?e=Backblaze" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://protocase.com/products/index.php?e=Backblaze', 'Protocase']);" >Protocase</a> &#8220;Backblaze-inspired&#8221; system with a Core i3 540 CPU, 8 GB memory, CentOS 6.3 x64, and 45x We&#8217;re just using this box for backup and it gives us about 79 TB usable, which is still plenty, so 2TB isn&#8217;t a big problem.

makeraid?.sh for filesystem creation:

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="bash" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">#!/bin/bash</span>
&nbsp;
mdadm <span style="color: #660033;">--create</span> <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>md0 <span style="color: #660033;">--level</span>=raid6 <span style="color: #660033;">-c</span> 256K <span style="color: #660033;">--raid-devices</span>=<span style="color: #000000;">45</span> \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sda <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdb <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdc <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdd <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sde \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdf <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdg <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdh <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdi <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdj \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdk <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdl <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdm <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdn <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdo \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdp <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdq <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdr <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sds <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdt \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdu <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdv <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdw <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdx <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdy \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdz <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdaa <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdab <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdac <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdad \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdae <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdaf <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdag <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdah <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdai \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdaj <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdak <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdal <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdam <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdan \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdao <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdap <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdaq <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdar <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdas</pre>
      </td>
    </tr>
  </table>
</div>

Filesystem:

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># mkfs.xfs -f /dev/md0</span>
meta-data=<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>md0               <span style="color: #007800;">isize</span>=<span style="color: #000000;">256</span>    <span style="color: #007800;">agcount</span>=<span style="color: #000000;">79</span>, <span style="color: #007800;">agsize</span>=<span style="color: #000000;">268435392</span> blks
         =                       <span style="color: #007800;">sectsz</span>=<span style="color: #000000;">512</span>   <span style="color: #007800;">attr</span>=<span style="color: #000000;">2</span>
data     =                       <span style="color: #007800;">bsize</span>=<span style="color: #000000;">4096</span>   <span style="color: #007800;">blocks</span>=<span style="color: #000000;">21000267072</span>, <span style="color: #007800;">imaxpct</span>=<span style="color: #000000;">1</span>
         =                       <span style="color: #007800;">sunit</span>=<span style="color: #000000;">64</span>     <span style="color: #007800;">swidth</span>=<span style="color: #000000;">2752</span> blks
naming   =version <span style="color: #000000;">2</span>              <span style="color: #007800;">bsize</span>=<span style="color: #000000;">4096</span>   ascii-ci=<span style="color: #000000;"></span>
log      =internal log           <span style="color: #007800;">bsize</span>=<span style="color: #000000;">4096</span>   <span style="color: #007800;">blocks</span>=<span style="color: #000000;">521728</span>, <span style="color: #007800;">version</span>=<span style="color: #000000;">2</span>
         =                       <span style="color: #007800;">sectsz</span>=<span style="color: #000000;">512</span>   <span style="color: #007800;">sunit</span>=<span style="color: #000000;">64</span> blks, lazy-count=<span style="color: #000000;">1</span>
realtime =none                   <span style="color: #007800;">extsz</span>=<span style="color: #000000;">4096</span>   <span style="color: #007800;">blocks</span>=<span style="color: #000000;"></span>, <span style="color: #007800;">rtextents</span>=<span style="color: #000000;"></span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># mount /dev/md0 /raid0/</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># df -h</span>
Filesystem            Size  Used Avail Use<span style="color: #000000; font-weight: bold;">%</span> Mounted on
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdat2            289G  3.2G  271G   <span style="color: #000000;">2</span><span style="color: #000000; font-weight: bold;">%</span> <span style="color: #000000; font-weight: bold;">/</span>
tmpfs                 3.9G  260K  3.9G   <span style="color: #000000;">1</span><span style="color: #000000; font-weight: bold;">%</span> <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>shm
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdat1            485M   62M  398M  <span style="color: #000000;">14</span><span style="color: #000000; font-weight: bold;">%</span> <span style="color: #000000; font-weight: bold;">/</span>boot
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>md0               79T   35M   79T   <span style="color: #000000;">1</span><span style="color: #000000; font-weight: bold;">%</span> <span style="color: #000000; font-weight: bold;">/</span>raid0</pre>
      </td>
    </tr>
  </table>
</div>

## RAID0

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># dd if=/dev/zero of=/raid0/zeros.dat bs=1M count=10000</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records <span style="color: #000000; font-weight: bold;">in</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records out
<span style="color: #000000;">10485760000</span> bytes <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">10</span> GB<span style="color: #7a0874; font-weight: bold;">&#41;</span> copied, <span style="color: #000000;">25.1944</span> s, <span style="color: #000000;">416</span> MB<span style="color: #000000; font-weight: bold;">/</span>s
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># rm -f /raid0/zeros.dat </span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># dd if=/dev/zero of=/raid0/zeros.dat bs=1M count=10000</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records <span style="color: #000000; font-weight: bold;">in</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records out
<span style="color: #000000;">10485760000</span> bytes <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">10</span> GB<span style="color: #7a0874; font-weight: bold;">&#41;</span> copied, <span style="color: #000000;">25.1922</span> s, <span style="color: #000000;">416</span> MB<span style="color: #000000; font-weight: bold;">/</span>s
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># rm -f /raid0/zeros.dat </span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># dd if=/dev/zero of=/raid0/zeros.dat bs=1M count=10000</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records <span style="color: #000000; font-weight: bold;">in</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records out
<span style="color: #000000;">10485760000</span> bytes <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">10</span> GB<span style="color: #7a0874; font-weight: bold;">&#41;</span> copied, <span style="color: #000000;">24.7665</span> s, <span style="color: #000000;">423</span> MB<span style="color: #000000; font-weight: bold;">/</span>s</pre>
      </td>
    </tr>
  </table>
</div>

## RAID5

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># dd if=/dev/zero of=/raid0/zeros.dat bs=1M count=10000</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records <span style="color: #000000; font-weight: bold;">in</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records out
<span style="color: #000000;">10485760000</span> bytes <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">10</span> GB<span style="color: #7a0874; font-weight: bold;">&#41;</span> copied, <span style="color: #000000;">25.2239</span> s, <span style="color: #000000;">416</span> MB<span style="color: #000000; font-weight: bold;">/</span>s
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># rm -f /raid0/zeros.dat </span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># dd if=/dev/zero of=/raid0/zeros.dat bs=1M count=10000</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records <span style="color: #000000; font-weight: bold;">in</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records out
<span style="color: #000000;">10485760000</span> bytes <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">10</span> GB<span style="color: #7a0874; font-weight: bold;">&#41;</span> copied, <span style="color: #000000;">24.7427</span> s, <span style="color: #000000;">424</span> MB<span style="color: #000000; font-weight: bold;">/</span>s
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># rm -f /raid0/zeros.dat </span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># dd if=/dev/zero of=/raid0/zeros.dat bs=1M count=10000</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records <span style="color: #000000; font-weight: bold;">in</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records out
<span style="color: #000000;">10485760000</span> bytes <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">10</span> GB<span style="color: #7a0874; font-weight: bold;">&#41;</span> copied, <span style="color: #000000;">24.2434</span> s, <span style="color: #000000;">433</span> MB<span style="color: #000000; font-weight: bold;">/</span>s</pre>
      </td>
    </tr>
  </table>
</div>

## RAID6:

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># dd if=/dev/zero of=/raid0/zeros.dat bs=1M count=10000</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records <span style="color: #000000; font-weight: bold;">in</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records out
<span style="color: #000000;">10485760000</span> bytes <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">10</span> GB<span style="color: #7a0874; font-weight: bold;">&#41;</span> copied, <span style="color: #000000;">26.9032</span> s, <span style="color: #000000;">390</span> MB<span style="color: #000000; font-weight: bold;">/</span>s
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># rm -f /raid0/zeros.dat </span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># dd if=/dev/zero of=/raid0/zeros.dat bs=1M count=10000</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records <span style="color: #000000; font-weight: bold;">in</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records out
<span style="color: #000000;">10485760000</span> bytes <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">10</span> GB<span style="color: #7a0874; font-weight: bold;">&#41;</span> copied, <span style="color: #000000;">26.5255</span> s, <span style="color: #000000;">395</span> MB<span style="color: #000000; font-weight: bold;">/</span>s
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># rm -f /raid0/zeros.dat </span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># dd if=/dev/zero of=/raid0/zeros.dat bs=1M count=10000</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records <span style="color: #000000; font-weight: bold;">in</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records out
<span style="color: #000000;">10485760000</span> bytes <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">10</span> GB<span style="color: #7a0874; font-weight: bold;">&#41;</span> copied, <span style="color: #000000;">26.4338</span> s, <span style="color: #000000;">397</span> MB<span style="color: #000000; font-weight: bold;">/</span>s</pre>
      </td>
    </tr>
  </table>
</div>

I found it pretty strange that RAID5 seemed to outperform RAID0, but I tested it several times and RAID5 averaged 10-15 MB/s faster than RAID0. Maybe a bug in the kernel? I tried other block sizes ranging from 60KB to 4MB for dd but the results were pretty consistent. In the end it looks like I&#8217;m going to go with RAID6 of 43 drives + 2 hotspares, which still yields ~400 MB/s throughput and 75 TB usable:

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="bash" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">#!/bin/bash</span>
&nbsp;
mdadm <span style="color: #660033;">--create</span> <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>md0 <span style="color: #660033;">--level</span>=raid6 <span style="color: #660033;">-c</span> 256K <span style="color: #660033;">-n</span> <span style="color: #000000;">43</span> <span style="color: #660033;">-x</span> <span style="color: #000000;">2</span> \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sda <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdb <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdc <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdd <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sde \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdf <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdg <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdh <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdi <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdj \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdk <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdl <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdm <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdn <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdo \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdp <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdq <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdr <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sds <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdt \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdu <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdv <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdw <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdx <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdy \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdz <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdaa <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdab <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdac <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdad \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdae <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdaf <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdag <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdah <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdai \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdaj <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdak <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdal <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdam <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdan \
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdao <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdap <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdaq <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdar <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdas</pre>
      </td>
    </tr>
  </table>
</div>

<ins datetime="2013-01-03T12:14:21+00:00">Update:</ins> A coworker suggested looking into <a href="https://raid.wiki.kernel.org/index.php/Write-intent_bitmap" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'https://raid.wiki.kernel.org/index.php/Write-intent_bitmap', 'write-intent bitmap']);" >write-intent bitmap</a> to improve rebuild speeds. After adding a 256 MB-chunked bitmap, the write performance didn&#8217;t degrade much, so this looks like a good addition to the configuration:

<div class="wp_syntax">
  <table>
    <tr>
      <td class="code">
        <pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># mdadm -G --bitmap-chunk=256M --bitmap=internal /dev/md0</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># dd if=/dev/zero of=/raid0/zeros.dat bs=1M count=10000</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records <span style="color: #000000; font-weight: bold;">in</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records out
<span style="color: #000000;">10485760000</span> bytes <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">10</span> GB<span style="color: #7a0874; font-weight: bold;">&#41;</span> copied, <span style="color: #000000;">25.8157</span> s, <span style="color: #000000;">406</span> MB<span style="color: #000000; font-weight: bold;">/</span>s
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># rm -fv /raid0/zeros.dat</span>
removed <span style="color: #000000; font-weight: bold;">`/</span>raid0<span style="color: #000000; font-weight: bold;">/</span>zeros.dat<span style="color: #ff0000;">'
[root@Protocase ~]# dd if=/dev/zero of=/raid0/zeros.dat bs=1M count=10000
10000+0 records in
10000+0 records out
10485760000 bytes (10 GB) copied, 26.4233 s, 397 MB/s
[root@Protocase ~]# rm -fv /raid0/zeros.dat
removed `/raid0/zeros.dat'</span>
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># dd if=/dev/zero of=/raid0/zeros.dat bs=1M count=10000</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records <span style="color: #000000; font-weight: bold;">in</span>
<span style="color: #000000;">10000</span>+<span style="color: #000000;"></span> records out
<span style="color: #000000;">10485760000</span> bytes <span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #000000;">10</span> GB<span style="color: #7a0874; font-weight: bold;">&#41;</span> copied, <span style="color: #000000;">26.2593</span> s, <span style="color: #000000;">399</span> MB<span style="color: #000000; font-weight: bold;">/</span>s
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># df -h</span>
Filesystem            Size  Used Avail Use<span style="color: #000000; font-weight: bold;">%</span> Mounted on
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdat2            289G  3.2G  271G   <span style="color: #000000;">2</span><span style="color: #000000; font-weight: bold;">%</span> <span style="color: #000000; font-weight: bold;">/</span>
tmpfs                 3.9G   88K  3.9G   <span style="color: #000000;">1</span><span style="color: #000000; font-weight: bold;">%</span> <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>shm
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>sdat1            485M   62M  398M  <span style="color: #000000;">14</span><span style="color: #000000; font-weight: bold;">%</span> <span style="color: #000000; font-weight: bold;">/</span>boot
<span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>md0               75T  9.8G   75T   <span style="color: #000000;">1</span><span style="color: #000000; font-weight: bold;">%</span> <span style="color: #000000; font-weight: bold;">/</span>raid0
<span style="color: #7a0874; font-weight: bold;">&#91;</span>root<span style="color: #000000; font-weight: bold;">@</span>Protocase ~<span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #666666; font-style: italic;"># cat /proc/mdstat</span>
Personalities : <span style="color: #7a0874; font-weight: bold;">&#91;</span>raid6<span style="color: #7a0874; font-weight: bold;">&#93;</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span>raid5<span style="color: #7a0874; font-weight: bold;">&#93;</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span>raid4<span style="color: #7a0874; font-weight: bold;">&#93;</span>
md0 : active raid6 sdas<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">44</span><span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>S<span style="color: #7a0874; font-weight: bold;">&#41;</span> sdar<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">43</span><span style="color: #7a0874; font-weight: bold;">&#93;</span><span style="color: #7a0874; font-weight: bold;">&#40;</span>S<span style="color: #7a0874; font-weight: bold;">&#41;</span> sdaq<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">42</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdap<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">41</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdao<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">40</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdan<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">39</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdam<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">38</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdal<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">37</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdak<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">36</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdaj<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">35</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdai<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">34</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdah<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">33</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdag<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">32</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdaf<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">31</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdae<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">30</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdad<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">29</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdac<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">28</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdab<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">27</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdaa<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">26</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdz<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">25</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdy<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">24</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdx<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">23</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdw<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">22</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdv<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">21</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdu<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">20</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdt<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">19</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sds<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">18</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdr<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">17</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdq<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">16</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdp<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">15</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdo<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">14</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdn<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">13</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdm<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">12</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdl<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">11</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdk<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">10</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdj<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">9</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdi<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">8</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdh<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">7</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdg<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">6</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdf<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">5</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sde<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">4</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdd<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">3</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdc<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">2</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sdb<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">1</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> sda<span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;"></span><span style="color: #7a0874; font-weight: bold;">&#93;</span>
      <span style="color: #000000;">80094041856</span> blocks super <span style="color: #000000;">1.2</span> level <span style="color: #000000;">6</span>, 256k chunk, algorithm <span style="color: #000000;">2</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span><span style="color: #000000;">43</span><span style="color: #000000; font-weight: bold;">/</span><span style="color: #000000;">43</span><span style="color: #7a0874; font-weight: bold;">&#93;</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span>UUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU<span style="color: #7a0874; font-weight: bold;">&#93;</span>
      bitmap: <span style="color: #000000;">2</span><span style="color: #000000; font-weight: bold;">/</span><span style="color: #000000;">4</span> pages <span style="color: #7a0874; font-weight: bold;">&#91;</span>8KB<span style="color: #7a0874; font-weight: bold;">&#93;</span>, 262144KB chunk
&nbsp;
unused devices: <span style="color: #000000; font-weight: bold;">&lt;</span>none<span style="color: #000000; font-weight: bold;">&gt;</span></pre>
      </td>
    </tr>
  </table>
</div>